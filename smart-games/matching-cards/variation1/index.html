<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>SMART - Emoji Match-Up</title>
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Fredoka+One&display=swap" rel="stylesheet">
<style>
  :root {
    --bg-color: #e0f7fa;
    --primary-blue: #0277bd;
    --accent-orange: #ffc107;
    --accent-orange-dark: #f57c00;
    --card-back-color: #ffffff;
    --text-color: #263238;
    --white: #ffffff;
    --success-green: #8bc34a;
    --disabled-gray: #bdbdbd;
  }

  * { box-sizing: border-box; -webkit-tap-highlight-color: transparent; }

  body {
    font-family: 'Fredoka One', cursive;
    display: flex;
    flex-direction: column;
    align-items: center;
    justify-content: center;
    height: 100vh;
    margin: 0;
    text-align: center;
    background-color: var(--bg-color);
    color: var(--text-color);
    overflow: hidden;
  }

  @keyframes zoomIn {
    from { transform: scale(0.9); opacity: 0; }
    to { transform: scale(1); opacity: 1; }
  }

  .screen {
    display: none;
    flex-direction: column;
    align-items: center;
    justify-content: center;
    width: 100%;
    height: 100%;
    padding: 20px;
    background: radial-gradient(circle, #ffffffc0 20%, #e0f7fa00 100%);
  }

  .active { display: flex; animation: zoomIn 0.4s ease-out; }
  .hidden { display: none !important; }

  h1 { font-size: 3.2em; color: var(--primary-blue); margin-bottom: 0; margin-top: 10px; }
  h2 { font-size: 2.5em; color: var(--primary-blue); }
  .welcome-subtitle { font-size: 1.5em; color: var(--text-color); margin-bottom: 10px; }

  p { font-size: 1.2em; max-width: 550px; line-height: 1.5; }

  .play-button {
    background-color: var(--accent-orange);
    border: none;
    color: var(--text-color);
    padding: 15px 40px;
    margin-top: 20px;
    font-size: 1.5em;
    font-family: 'Fredoka One', cursive;
    border-radius: 50px;
    cursor: pointer;
    transition: all 0.2s ease;
    box-shadow: 0 5px 0 var(--accent-orange-dark);
    text-transform: uppercase;
    font-weight: 600;
  }
  .play-button:hover:not(:disabled) {
    background-color: #ffd54f;
    transform: translateY(-2px);
    box-shadow: 0 7px 0 var(--accent-orange-dark);
  }
  .play-button:active:not(:disabled) {
    transform: translateY(2px);
    box-shadow: 0 3px 0 var(--accent-orange-dark);
  }

  .game-container { width: 100%; max-width: 480px; }
  .timer-bar-container { width: 100%; height: 20px; background-color: #b0bec5; border-radius: 20px; border: 3px solid var(--white); margin: 0 auto 20px auto; overflow: hidden; box-shadow: 0 2px 5px rgba(0,0,0,0.1); }
  .timer-bar { height: 100%; width: 100%; background-color: var(--success-green); border-radius: 20px; transition: width 1s linear; }
  .game-board { display: grid; grid-template-columns: repeat(4, 1fr); gap: 12px; perspective: 1000px; }
  .card { background-color: transparent; width: 100%; aspect-ratio: 1 / 1; border: none; cursor: pointer; }
  .card-inner { position: relative; width: 100%; height: 100%; transition: transform 0.6s; transform-style: preserve-3d; }
  .card.flipped .card-inner { transform: rotateY(180deg); }
  .card-front, .card-back { position: absolute; width: 100%; height: 100%; -webkit-backface-visibility: hidden; backface-visibility: hidden; display: flex; justify-content: center; align-items: center; border-radius: 15px; box-shadow: 0 6px 0 var(--disabled-gray); transition: all 0.1s ease-out; }
  .card-front { background: var(--accent-orange); color: var(--white); font-size: 3rem; }
  .card-front::before { content: '‚≠ê'; text-shadow: 0 2px 4px rgba(0,0,0,0.2); }
  .card-back { background-color: var(--card-back-color); color: var(--text-color); transform: rotateY(180deg); font-size: 2.8rem; }
  .card.shake { animation: shake 0.5s; }
  @keyframes shake { 0%, 100% { transform: translateX(0); } 25% { transform: translateX(-8px); } 75% { transform: translateX(8px); } }
  .countdown { font-size: 8rem; color: var(--primary-blue); opacity: 0; transition: opacity 0.5s ease-in-out, transform 0.5s ease-in-out; transform: scale(0.5); }
  .fade-in { opacity: 1 !important; transform: scale(1); }
  .final-summary { font-size: 1.2em; background: var(--white); border: 3px solid var(--primary-blue); border-radius: 15px; padding: 20px 30px; max-width: 500px; box-shadow: 0 4px 15px rgba(0,0,0,0.1); }
  .final-score { font-size: 1.8em; color: var(--accent-orange); font-weight: 600; }

  /* --- INSTRUCTIONS / PAUSE OVERLAY --- */
  .help-button {
    position: fixed;
    bottom: 15px;
    left: 15px;
    width: 50px;
    height: 50px;
    border-radius: 50%;
    font-size: 1.8em;
    font-family: 'Fredoka One', cursive;
    background-color: var(--primary-blue);
    color: var(--white);
    border: 3px solid var(--white);
    box-shadow: 0 4px 10px rgba(0,0,0,0.2);
    z-index: 1000;
    cursor: pointer;
    display: flex;
    justify-content: center;
    align-items: center;
    line-height: 1;
  }
  .overlay {
    position: fixed; top: 0; left: 0; width: 100%; height: 100%;
    background-color: rgba(0,0,0,0.6);
    display: flex; justify-content: center; align-items: center;
    z-index: 2000;
    padding: 15px;
  }
  .overlay-content {
    background-color: var(--card-back-color);
    padding: 20px 30px;
    border-radius: 20px;
    border: 3px solid var(--primary-blue);
    width: 100%;
    max-width: 500px;
  }
  .overlay-content h2 { margin-top: 0; }

  @media (max-width: 600px) {
    h1 { font-size: 2.5em; }
    p { font-size: 1em; }
    .play-button { font-size: 1.2em; }
    .card-back { font-size: 2rem; }
    .countdown { font-size: 6rem; }
  }
</style>
</head>
<body>

  <!-- START SCREEN -->
  <div class="screen active" id="startScreen">
    <h2 class="welcome-subtitle">Welcome to the SMART Challenge!</h2>
    <h1>Emoji Match-Up</h1>
    <p>This is a game just for you. Your goal is to match the emoji pairs to clear the board. Try and complete as many rounds as you can before the timer runs out!</p>
    <button class="play-button" onclick="startCountdown()">Start Game</button>
  </div>

  <!-- COUNTDOWN -->
  <div class="screen" id="countdownScreen">
    <div class="countdown" id="countdownText">3</div>
  </div>

  <!-- GAME -->
  <div class="screen" id="gameScreen">
    <div class="game-container">
      <div class="timer-bar-container">
        <div class="timer-bar" id="timerBar"></div>
      </div>
      <div class="game-board" id="gameBoard"></div>
    </div>
  </div>

  <!-- ROUND COMPLETE -->
  <div class="screen" id="roundEndScreen">
    <h2>Round Cleared!</h2>
    <p id="roundResultText"></p>
    <button class="play-button" id="nextRoundBtn" onclick="startNextRound()">Next Round</button>
  </div>

  <!-- FINAL SCREEN -->
  <div class="screen" id="finalScreen">
    <div class="final-summary">
        <h2>Good Job!</h2>
        <p id="finalResults"></p>
        <p>Now press the red arrow on the bottom right of the screen to finish, and you will have earned $2.50 for your SMART bank!</p>
    </div>
  </div>

  <!-- HELP BUTTON AND OVERLAY -->
  <button id="helpButton" class="help-button hidden">?</button>
  <div id="helpOverlay" class="overlay hidden">
    <div class="overlay-content">
      <h2>How to Play</h2>
      <p>The timer is paused. Your goal is to match all the emoji pairs to clear the board. Complete as many rounds as you can!</p>
      <button class="play-button" id="closeHelpButton">Close</button>
    </div>
  </div>

  <script>
    const emojis = ['üòÄ', 'üò¢', 'üòá', 'üòç', 'üòé', 'ü•≥', 'ü•∏', 'üòê'];
    const totalPairs = emojis.length;
    const totalGameTime = 300; // 5 minutes

    let cards = [], firstCard = null, timer = null;
    let lockBoard = false, matches = 0, roundNumber = 1;
    let timeRemaining = totalGameTime, roundsCompleted = 0;

    const startScreen = document.getElementById('startScreen');
    const countdownScreen = document.getElementById('countdownScreen');
    const gameScreen = document.getElementById('gameScreen');
    const roundEndScreen = document.getElementById('roundEndScreen');
    const finalScreen = document.getElementById('finalScreen');
    const board = document.getElementById('gameBoard');
    const countdownText = document.getElementById('countdownText');
    const roundResultText = document.getElementById('roundResultText');
    const finalResults = document.getElementById('finalResults');
    const timerBar = document.getElementById('timerBar');
    const helpButton = document.getElementById('helpButton');
    const helpOverlay = document.getElementById('helpOverlay');
    const closeHelpButton = document.getElementById('closeHelpButton');

    helpButton.addEventListener('click', pauseGame);
    closeHelpButton.addEventListener('click', resumeGame);

    function switchScreen(from, to) {
      from.classList.remove('active');
      to.classList.add('active');
    }

    function shuffle(array) {
      let newArray = [...array];
      for (let i = newArray.length - 1; i > 0; i--) {
        const j = Math.floor(Math.random() * (i + 1));
        [newArray[i], newArray[j]] = [newArray[j], newArray[i]];
      }
      return newArray;
    }

    function startCountdown() {
      switchScreen(startScreen, countdownScreen);
      // Reset game state for a new game
      timeRemaining = totalGameTime;
      roundsCompleted = 0;
      roundNumber = 1;
      
      let count = 3;
      countdownText.textContent = count;
      countdownText.classList.add('fade-in');

      const interval = setInterval(() => {
        countdownText.classList.remove('fade-in');
        setTimeout(() => {
          count--;
          if (count <= 0) {
            countdownText.textContent = "GO!";
            countdownText.classList.add('fade-in');
            clearInterval(interval);
            setTimeout(() => {
              switchScreen(countdownScreen, gameScreen);
              helpButton.classList.remove('hidden');
              startGameTimer();
              initGame();
            }, 1000);
          } else {
            countdownText.textContent = count;
            countdownText.classList.add('fade-in');
          }
        }, 500);
      }, 1000);
    }

    function startGameTimer() {
      if (timer) clearInterval(timer);
      updateTimerDisplay();
      timer = setInterval(() => {
        timeRemaining--;
        updateTimerDisplay();
        if (timeRemaining <= 0) {
          clearInterval(timer);
          endGame();
        }
      }, 1000);
    }

    function pauseGame() {
      clearInterval(timer);
      helpOverlay.classList.remove('hidden');
    }

    function resumeGame() {
      helpOverlay.classList.add('hidden');
      startGameTimer(); // This will resume the timer
    }

    function updateTimerDisplay() {
      const percentage = (timeRemaining / totalGameTime) * 100;
      timerBar.style.width = `${percentage}%`;
    }

    function initGame() {
      let cardEmojis = shuffle([...emojis, ...emojis]);
      board.innerHTML = '';
      matches = 0;
      firstCard = null;
      lockBoard = false;

      cardEmojis.forEach(emoji => {
        const cardElement = document.createElement('div');
        cardElement.classList.add('card');
        cardElement.dataset.emoji = emoji;
        cardElement.innerHTML = `<div class="card-inner"><div class="card-front"></div><div class="card-back">${emoji}</div></div>`;
        cardElement.addEventListener('click', flipCard);
        board.appendChild(cardElement);
      });
    }

    function flipCard() {
      if (lockBoard || this.classList.contains('flipped') || this === firstCard) return;
      this.classList.add('flipped');
      if (!firstCard) {
        firstCard = this;
        return;
      }
      const secondCard = this;
      lockBoard = true;
      checkForMatch(firstCard, secondCard);
    }

    function checkForMatch(card1, card2) {
      const isMatch = card1.dataset.emoji === card2.dataset.emoji;
      isMatch ? handleMatch(card1, card2) : handleMismatch(card1, card2);
    }

    function handleMatch(card1, card2) {
      card1.removeEventListener('click', flipCard);
      card2.removeEventListener('click', flipCard);
      matches++;
      setTimeout(() => {
          firstCard = null;
          lockBoard = false;
          if (matches === totalPairs) {
            roundsCompleted++;
            setTimeout(() => {
                roundResultText.textContent = `You finished round ${roundNumber}!`;
                switchScreen(gameScreen, roundEndScreen);
            }, 500);
          }
      }, 400);
    }

    function handleMismatch(card1, card2) {
      card1.classList.add('shake');
      card2.classList.add('shake');
      setTimeout(() => {
        card1.classList.remove('flipped', 'shake');
        card2.classList.remove('flipped', 'shake');
        firstCard = null;
        lockBoard = false;
      }, 1000);
    }

    function startNextRound() {
      roundNumber++;
      switchScreen(roundEndScreen, gameScreen);
      initGame();
    }

    function endGame() {
      helpButton.classList.add('hidden'); // Hide help button on final screen
      finalResults.innerHTML = `Check out your scores below!<br><span class="final-score">${roundsCompleted} Rounds Completed!</span>`;
      switchScreen(gameScreen, finalScreen);
      window.parent.postMessage("showNext", "*");
    }
  </script>
</body>
</html>
