<!DOCTYPE html>
<html lang="en">
<head>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta charset="UTF-8" />
  <title>Digit Span Rewind Challenge</title>
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;600&display=swap" rel="stylesheet">
  <link href="https://fonts.googleapis.com/css2?family=Orbitron:wght@600&display=swap" rel="stylesheet">
  <style>
    /* All CSS is identical to the last working version. No changes needed. */
    * { box-sizing: border-box; margin: 0; padding: 0; } body { font-family: 'Poppins', sans-serif; text-align: center; padding: 10px; overflow-x: hidden; color: #fff; background-color: #0d0d21; -webkit-tap-highlight-color: transparent; } #digital-background { position: fixed; top: 0; left: 0; width: 100%; height: 100%; z-index: -1; --grid-size: 50px; --line-color: rgba(0, 183, 255, 0.1); background-image: linear-gradient(to right, var(--line-color) 1px, transparent 1px), linear-gradient(to bottom, var(--line-color) 1px, transparent 1px); background-size: var(--grid-size) var(--grid-size); animation: pan-grid 60s linear infinite; } @keyframes pan-grid { from { background-position: 0 0; } to { background-position: var(--grid-size) var(--grid-size); } } .container { max-width: 900px; margin: auto; background-color: rgba(13, 13, 33, 0.5); border: 1px solid rgba(0, 183, 255, 0.3); backdrop-filter: blur(10px); border-radius: 20px; padding: 15px 10px; box-shadow: 0 0 30px rgba(0,0,0,0.4); display: flex; flex-direction: column; align-items: center; position: relative; z-index: 1; } .main { flex: 1; margin-bottom: 15px; width: 100%; } .main-title { font-size: clamp(22px, 6vw, 32px); font-weight: 600; color: #fff; text-shadow: 0 0 10px rgba(0, 183, 255, 0.7); margin-bottom: 8px; } #info-bar { font-size: clamp(16px, 4vw, 20px); font-weight: 600; text-shadow: 0 0 5px #fff; margin-bottom: 8px; display: flex; justify-content: space-between; align-items: center; padding: 0 15px; } #how-to-play-btn { font-family: 'Poppins', sans-serif; font-size: 20px; font-weight: 600; color: #fff; background-color: rgba(0, 183, 255, 0.3); border: 1px solid rgba(0, 183, 255, 0.7); width: 35px; height: 35px; border-radius: 50%; cursor: pointer; transition: all 0.2s ease; } #how-to-play-btn:hover { background-color: #00b7ff; box-shadow: 0 0 10px #00b7ff; } .digit-display, #answer-display { font-size: clamp(28px, 8vw, 42px); font-weight: 600; color: #fff; text-shadow: 0 0 5px #fff, 0 0 10px #0ff; background-color: rgba(0,0,0,0.4); border-radius: 10px; margin: 10px 0; min-height: 55px; letter-spacing: 0.2em; display: flex; align-items: center; justify-content: center; position: relative; overflow: hidden; padding: 0 10px; } .digit-display-instruction { font-family: 'Orbitron', sans-serif; font-size: clamp(18px, 5vw, 22px); font-weight: 600; letter-spacing: normal; text-shadow: none; color: rgba(255, 255, 255, 0.9); } #instructions-modal { position: fixed; top: 0; left: 0; width: 100%; height: 100%; background-color: rgba(0, 0, 0, 0.7); display: none; align-items: center; justify-content: center; z-index: 100; } #instructions-modal.show { display: flex; } .modal-content { background-color: #f9f9f9; color: #333; padding: 20px; border-radius: 15px; max-width: 90vw; width: 400px; text-align: center; } .modal-content h3 { font-size: 22px; margin-top: 0; margin-bottom: 15px; } .modal-content ul { list-style-type: none; padding: 0; text-align: left; display: inline-block; margin-bottom: 20px; } .modal-content li { margin-bottom: 10px; font-size: 16px; } #close-modal-btn { font-size: 18px; font-weight: 600; background: #0077b6; border: 2px solid #00b7ff; border-radius: 30px; padding: 10px 25px; color: white; cursor: pointer; transition: all 0.3s ease; } #close-modal-btn:hover { background-color: #00b7ff; box-shadow: 0 0 20px #00b7ff; } #instructions-container { background: rgba(255, 255, 255, 0.94); border-radius: 20px; padding: 15px; box-shadow: 0 0 25px rgba(0,0,0,0.2); max-width: 600px; margin: 0 auto 20px auto; color: #333; } #instructions-container h3 { font-size: 20px; margin-bottom: 10px; } #instructions-container ul { list-style-type: none; padding: 0; margin: 0 auto; text-align: left; display: inline-block; } #instructions-container li { font-size: 15px; line-height: 1.5; margin-bottom: 10px; } #instructions-btn { font-size: 18px; font-weight: 600; background: #0077b6; border: 2px solid #00b7ff; border-radius: 30px; padding: 12px 30px; color: white; cursor: pointer; transition: all 0.3s ease; margin-top: 15px; } #instructions-btn:hover { background-color: #00b7ff; box-shadow: 0 0 20px #00b7ff; } .option-buttons { display: grid; grid-template-columns: repeat(3, 1fr); grid-template-rows: repeat(4, auto); gap: 5px; margin-top: 15px; } .option-buttons button { font-family: 'Poppins', sans-serif; font-size: 26px; width: 100%; min-width: 0; height: 55px; background-color: #0077b6; color: #fff; border: 2px solid #00b7ff; border-radius: 50%; cursor: pointer; transition: all 0.2s ease; display: flex; align-items: center; justify-content: center; padding: 0; } .option-buttons button:hover, .option-buttons button:active { background-color: #00b7ff; box-shadow: 0 0 15px #00b7ff; } .option-buttons button#backspace-btn { background-color: #c0392b; border-color: #e74c3c; grid-row: 4; grid-column: 1 / 2; } .option-buttons button#backspace-btn:hover { background-color: #e74c3c; box-shadow: 0 0 15px #e74c3c; } .option-buttons button#btn-zero { grid-row: 4; grid-column: 2 / 3; } .option-buttons button#submit-btn { background-color: #27ae60; border-color: #2ecc71; border-radius: 12px; grid-row: 4; grid-column: 3 / 4; font-size: 24px; } .option-buttons button#submit-btn:hover { background-color: #2ecc71; box-shadow: 0 0 15px #2ecc71; } .hidden { display: none; } .message { font-size: 18px; margin-top: 15px; min-height: 24px; color: #fff; font-weight: 600; } #streak-tracker { margin-top: 10px; min-height: 25px; display: flex; justify-content: center; align-items: center; gap: 8px; } .data-packet { width: 40px; height: 12px; border: 2px solid #00b7ff; border-radius: 4px; background-color: transparent; transition: all 0.5s ease; } .data-packet.filled { background-color: #00b7ff; box-shadow: 0 0 10px #00b7ff; } .badge-earned { background-color: #00b7ff; color: #fff; font-weight: 600; padding: 4px 8px; margin: 3px; border-radius: 8px; box-shadow: 0 0 8px #00b7ff; font-size: 13px; } #badge-popup { position: fixed; left: 50%; transform: translateX(-50%); top: -150px; background-color: rgba(13, 13, 33, 0.7); border: 1px solid rgba(0, 183, 255, 0.5); backdrop-filter: blur(10px); padding: 15px 30px; border-radius: 10px; font-size: 18px; font-weight: 600; color: #fff; text-shadow: 0 0 8px #0ff; box-shadow: 0 0 20px rgba(0, 183, 255, 0.5); z-index: 10; transition: top 0.5s ease-out; overflow: hidden; width: 90vw; } #badge-popup.show { top: 20px; } #badge-popup::after { content: ''; position: absolute; top: -100%; left: 0; width: 100%; height: 100%; background: linear-gradient(0deg, transparent, rgba(0, 183, 255, 0.3), transparent); animation: scanline 3s linear infinite; } @keyframes scanline { from { top: -100%; } to { top: 100%; } } #final-summary { background: rgba(255, 255, 255, 0.88); border-radius: 20px; padding: 20px; box-shadow: 0 0 20px rgba(0,0,0,0.15); margin: 15px auto; font-size: 16px; color: #333; max-width: 90vw; }
  </style>
</head>
<body>
  <div id="digital-background"></div>
  <div class="main-title">Digit Span Rewind Challenge</div>

  <div id="instructions-container">
    <h3>Welcome to the SMART Challenge üß†‚è™</h3>
    <ul>
      <li>‚≠ê This is a challenge <strong>just for you.</strong></li>
      <li>‚è™ The numbers will flash one by one. Your mission is to type them back in <strong>REVERSE</strong> order.</li>
      <li>üèÜ For example, if you see <strong>7-1-4</strong>, you must type <strong>4-1-7</strong>. See how high you can get!</li>
    </ul>
    <button id="instructions-btn">Let's go!</button>
  </div>

  <div class="container hidden" id="game">
    <div class="main">
      <div id="info-bar">
        <span>Time: <span id="timer-display">05:00</span></span>
        <button id="how-to-play-btn">?</button>
      </div>
      <div class="digit-display" id="digit-display"></div>
      <div id="answer-display"></div>
      <div class="option-buttons hidden" id="option-buttons"></div>
      <div class="message" id="message"></div>
      <div id="streak-tracker">
        <div class="data-packet"></div>
        <div class="data-packet"></div>
        <div class="data-packet"></div>
      </div>
      <div id="final-summary" class="hidden"></div>
    </div>
    <div class="badge-tracker">
      <h3>üèÜ Badges</h3>
      <div id="badges-earned"></div>
    </div>
  </div>

  <div id="badge-popup"></div>

  <!-- --- CHANGE: Updated modal instructions to be specific to REWIND --- -->
  <div id="instructions-modal">
    <div class="modal-content">
        <h3>How to Play: Rewind!</h3>
        <ul>
            <li>1. Watch the numbers flash on the screen.</li>
            <li>2. Your mission is to type them back in <strong>REVERSE</strong> order.</li>
            <li>3. For example, if you see <strong>7-1-4</strong>, you must type <strong>4-1-7</strong>.</li>
            <li>4. Press the green check (‚úì) to submit!</li>
        </ul>
        <button id="close-modal-btn">Got it!</button>
    </div>
  </div>

  <script>
    // The JavaScript logic is all correct and unchanged from the last version.
    var badgeLevels = { 4: "Digit Detective", 5: "Memory Master", 6: "Sequence Star", 7: "Cognitive Champion", 8: "Unstoppable", 9: "Brainy Boss" };
    var digits = '1234567890';
    var correctMessages = ["Correct!", "Nice!", "Good job!", "You got it!", "Perfect!", "Excellent!", "You're on a roll!"];
    var encouragementMessages = [ "Try again!", "Let's try a different one!", "You got this!", "Almost!" ];
    var currentLength = 3; 
    var consecutiveCorrect = 0;
    var personalBest = 0;
    var earnedBadges = {};
    var isChecking = false;
    var isGameOver = false;
    var gameTimerInterval = null; 
    var timeRemaining;
    const GAME_DURATION = 300; 
    
    var instructionsContainer = document.getElementById('instructions-container');
    var instructionsBtn = document.getElementById('instructions-btn');
    var gameContainer = document.getElementById('game');
    var timerDisplayEl, infoBar, digitDisplay, optionButtons, answerDisplay, message, badgesEarned, badgePopup, finalSummary, streakTracker, howToPlayBtn, instructionsModal, closeModalBtn;
    var sequence = '';
    var userAnswer = '';

    instructionsBtn.onclick = function() {
      instructionsContainer.style.display = 'none';
      gameContainer.classList.remove('hidden');
      startGame();
    };

    function pauseGameTimer() { clearInterval(gameTimerInterval); }
    function resumeGameTimer() { if (isGameOver) return; clearInterval(gameTimerInterval); gameTimerInterval = setInterval(updateTimer, 1000); }
    function updateTimer() { if (timeRemaining < 0) { clearInterval(gameTimerInterval); showFinalSummary(); return; } var minutes = Math.floor(timeRemaining / 60); var seconds = timeRemaining % 60; timerDisplayEl.textContent = minutes.toString().padStart(2, '0') + ':' + seconds.toString().padStart(2, '0'); timeRemaining--; }
    
    function getReadyCountdown(callback) { digitDisplay.classList.add('digit-display-instruction'); digitDisplay.textContent = 'Remember these numbers...'; setTimeout(function() { digitDisplay.textContent = ''; callback(); }, 1500); }
    function flashNextDigit(index) { if (isGameOver) return; if (index === 0) { digitDisplay.classList.remove('digit-display-instruction'); } if (index >= sequence.length) { digitDisplay.classList.add('digit-display-instruction'); digitDisplay.textContent = "Your turn!"; setTimeout(function() { displayOptions(); isChecking = false; }, 1000); return; } digitDisplay.textContent = sequence[index]; setTimeout(function() { digitDisplay.textContent = ''; setTimeout(function() { flashNextDigit(index + 1); }, 250); }, 750); }
    function capLength(length) { return Math.min(length, 10); } 
    function generateDigits(length) { var result = ''; var availableDigits = '0123456789'.split(''); for (var i = 0; i < length; i++) { var randomIndex = Math.floor(Math.random() * availableDigits.length); result += availableDigits.splice(randomIndex, 1)[0]; } return result; }
    function updateStreakVisual() { var packets = streakTracker.querySelectorAll('.data-packet'); packets.forEach(function(packet, index) { packet.classList.toggle('filled', index < consecutiveCorrect); }); }
    function showBadge(name) { if (earnedBadges[name]) return; earnedBadges[name] = true; var badge = document.createElement('div'); badge.className = 'badge-earned'; badge.textContent = 'üéñÔ∏è ' + name; badgesEarned.appendChild(badge); badgePopup.textContent = 'üéâ Badge Unlocked: ' + name + '! üéâ'; badgePopup.classList.add('show'); setTimeout(function() { badgePopup.classList.remove('show'); }, 3500); }
    function showDigits() { if (isGameOver) return; isChecking = true; sequence = generateDigits(currentLength); answerDisplay.textContent = ''; userAnswer = ''; optionButtons.classList.add('hidden'); message.textContent = ''; getReadyCountdown(function() { flashNextDigit(0); }); }
    function displayOptions() { if (isGameOver) return; digitDisplay.classList.remove('digit-display-instruction'); digitDisplay.textContent = ''; optionButtons.innerHTML = ''; digits.split('').forEach(function(d) { var btn = document.createElement('button'); btn.textContent = d; if (d === '0') { btn.id = 'btn-zero'; } btn.onclick = function() { if(userAnswer.length < currentLength) { userAnswer += d; answerDisplay.textContent = userAnswer; } }; optionButtons.appendChild(btn); }); var backspaceBtn = document.createElement('button'); backspaceBtn.innerHTML = '‚å´'; backspaceBtn.id = 'backspace-btn'; backspaceBtn.onclick = function() { userAnswer = userAnswer.slice(0, -1); answerDisplay.textContent = userAnswer; }; optionButtons.appendChild(backspaceBtn); var submitBtn = document.createElement('button'); submitBtn.innerHTML = '‚úì'; submitBtn.id = 'submit-btn'; submitBtn.onclick = checkAnswer; optionButtons.appendChild(submitBtn); optionButtons.classList.remove('hidden'); }
    function triggerGlitch() { digitDisplay.classList.add('glitch'); setTimeout(function() { digitDisplay.classList.remove('glitch'); }, 500); }
    
    function checkAnswer() {
      if (isGameOver || isChecking) return;
      isChecking = true;
      optionButtons.classList.add('hidden');
      var delayForNextTurn = 1500;
      var correctRewindAnswer = sequence.split('').reverse().join('');
      if (userAnswer === correctRewindAnswer) {
        consecutiveCorrect++;
        updateStreakVisual();
        personalBest = Math.max(personalBest, currentLength);
        if (consecutiveCorrect >= 3) {
          consecutiveCorrect = 0;
          currentLength = capLength(currentLength + 1);
          message.textContent = 'Level Up!';
          triggerGlitch();
          if (badgeLevels[currentLength]) {
            showBadge(badgeLevels[currentLength]);
            delayForNextTurn = 3600;
          }
        } else {
          var randomIndex = Math.floor(Math.random() * correctMessages.length);
          message.textContent = correctMessages[randomIndex];
        }
      } else {
        consecutiveCorrect = 0;
        updateStreakVisual();
        var randomIndex = Math.floor(Math.random() * encouragementMessages.length);
        message.textContent = encouragementMessages[randomIndex];
        currentLength = Math.max(3, currentLength - 1);
      }
      setTimeout(moveToNextTurn, delayForNextTurn);
    }
    
    function moveToNextTurn() { if (isGameOver) return; if (consecutiveCorrect === 0) { setTimeout(updateStreakVisual, 500); } showDigits(); }
    
    function showFinalSummary() {
      isGameOver = true;
      if (gameTimerInterval) clearInterval(gameTimerInterval);
      isChecking = true;
      infoBar.classList.add('hidden');
      digitDisplay.textContent = '';
      answerDisplay.textContent = '';
      message.textContent = '';
      optionButtons.classList.add('hidden');
      streakTracker.classList.add('hidden');
      finalSummary.classList.remove('hidden');
      var summaryHtml = "<h2>Good job - Check out your score below!</h2>";
      summaryHtml += "<p><strong>Your Personal Best Was Level: " + personalBest + "</strong></p>";
      summaryHtml += "<p>Now press the red arrow on the bottom right of the screen to finish, and you will have earned $2.50 for your SMART bank!</p>";
      finalSummary.innerHTML = summaryHtml;
      window.parent.postMessage("showNext", "*");
    } 

    function startGame() {
      timerDisplayEl = document.getElementById('timer-display');
      infoBar = document.getElementById('info-bar');
      digitDisplay = document.getElementById('digit-display');
      optionButtons = document.getElementById('option-buttons');
      answerDisplay = document.getElementById('answer-display');
      message = document.getElementById('message');
      badgesEarned = document.getElementById('badges-earned');
      badgePopup = document.getElementById('badge-popup');
      finalSummary = document.getElementById('final-summary');
      streakTracker = document.getElementById('streak-tracker');
      howToPlayBtn = document.getElementById('how-to-play-btn');
      instructionsModal = document.getElementById('instructions-modal');
      closeModalBtn = document.getElementById('close-modal-btn');
      
      howToPlayBtn.onclick = function() { instructionsModal.classList.add('show'); pauseGameTimer(); }
      closeModalBtn.onclick = function() { instructionsModal.classList.remove('show'); resumeGameTimer(); }
      instructionsModal.onclick = function(event) { if (event.target === instructionsModal) { instructionsModal.classList.remove('show'); resumeGameTimer(); } }
      
      isGameOver = false; currentLength = 3; consecutiveCorrect = 0; personalBest = 0; earnedBadges = {}; timeRemaining = GAME_DURATION; badgesEarned.innerHTML = ''; finalSummary.classList.add('hidden'); streakTracker.classList.remove('hidden'); infoBar.classList.remove('hidden');
      updateStreakVisual(); updateTimer(); resumeGameTimer(); showDigits();
    }
  </script>
</body>
</html>
