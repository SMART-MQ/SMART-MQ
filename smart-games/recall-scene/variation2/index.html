<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Color Memory Game</title>
  <style>
    body {
      background-color: #fcefe3;
      font-family: 'Arial', sans-serif;
      color: black;
      text-align: center;
      margin: 0;
      padding: 0;
    }

    h1 {
      margin-top: 20px;
    }

    .game-area {
      margin: 20px auto;
      max-width: 600px;
      position: relative;
    }

    .grid {
      display: grid;
      grid-template-columns: repeat(4, 1fr);
      gap: 10px;
      margin-top: 20px;
    }

    .cell {
      width: 90px;
      height: 90px;
      border-radius: 10px;
    }

    .hidden {
      display: none;
    }

    .message {
      font-size: 18px;
      margin-top: 10px;
    }

    button {
      background-color: #a8dadc;
      border: none;
      color: black;
      padding: 10px 20px;
      margin: 20px 10px;
      font-size: 16px;
      border-radius: 10px;
      cursor: pointer;
    }

    input[type="text"] {
      padding: 8px;
      font-size: 16px;
      margin: 10px;
      border-radius: 5px;
      border: 1px solid #ccc;
      width: 300px;
    }

    #roundCounter {
      position: fixed;
      bottom: 10px;
      left: 10px;
      background: #a8dadc;
      padding: 8px 12px;
      border-radius: 8px;
      font-weight: bold;
      z-index: 1000;
      user-select: none;
      font-size: 16px;
    }

    #finalSummary {
      margin-top: 40px;
      font-size: 22px;
      background: #e1f0f7;
      border-radius: 10px;
      padding: 30px;
      display: none;
    }

    #correctDisplay {
      font-size: 18px;
      margin-top: 20px;
      background: #f0f0f0;
      border-radius: 10px;
      padding: 15px;
      display: none;
    }

    .display-colors {
      margin-top: 10px;
      display: flex;
      justify-content: center;
      gap: 10px;
    }

    .color-box {
      width: 40px;
      height: 40px;
      border-radius: 5px;
      border: 1px solid #000;
    }
  </style>
</head>
<body>
  <h1>üé® Color Memory Game üé®</h1>
  <p>Memorize the colors in the grid! You'll be asked to recall a specific row or column.</p>

  <div id="roundCounter" class="message">Round 0 of 5 ‚Äî 5 rounds remaining</div>

  <div class="game-area">
    <div id="grid" class="grid"></div>
    <p id="prompt" class="message hidden"></p>
    <p id="countdown" class="message hidden">‚è≥ Time left to remember: <span id="timer">60</span> seconds</p>

    <div id="input-area" class="hidden">
      <p>Type the colors in order (like "red, blue, green"):</p>
      <input type="text" id="answer" placeholder="e.g. red, yellow, blue" autocomplete="off"/>
      <button id="submit">Submit</button>
    </div>

    <div id="result" class="hidden"></div>
    <div id="correctDisplay"></div>
    <button id="start">Start Game</button>
    <button id="next" class="hidden">Next Round</button>
    <div id="finalSummary"></div>
  </div>

  <script>
    const simpleColors = ["red","blue","green","yellow","orange","purple","pink"];
    const totalRounds = 5;

    const gridDiv = document.getElementById("grid");
    const promptP = document.getElementById("prompt");
    const countdownP = document.getElementById("countdown");
    const timerSpan = document.getElementById("timer");
    const inputArea = document.getElementById("input-area");
    const answerInput = document.getElementById("answer");
    const submitBtn = document.getElementById("submit");
    const resultDiv = document.getElementById("result");
    const correctDisplay = document.getElementById("correctDisplay");
    const startBtn = document.getElementById("start");
    const nextBtn = document.getElementById("next");
    const roundCounter = document.getElementById("roundCounter");
    const finalSummary = document.getElementById("finalSummary");

    let currentRound = 0;
    let grid = [];
    let recallSet = [];
    let promptText = "";
    let timer = null;
    let timeLeft = 60;
    let score = 0;

    function normalizeColor(input){
      return input.toLowerCase().trim();
    }

    // Updated createGrid to use all unique colors before repeating
    function createGrid() {
      // Create an array of 16 colors cycling through all unique colors before repeating
      const chosenColors = [];
      const totalCells = 16;
      const colorsCount = simpleColors.length;

      // Add colors in order repeatedly until length = 16
      while (chosenColors.length < totalCells) {
        for (let color of simpleColors) {
          if (chosenColors.length < totalCells) {
            chosenColors.push(color);
          } else {
            break;
          }
        }
      }

      // Optional: shuffle chosenColors so the grid is randomized but all colors appear equally before repeat
      for (let i = chosenColors.length - 1; i > 0; i--) {
        const j = Math.floor(Math.random() * (i + 1));
        [chosenColors[i], chosenColors[j]] = [chosenColors[j], chosenColors[i]];
      }

      grid = [];
      for (let i = 0; i < 4; i++) {
        grid.push(chosenColors.slice(i * 4, i * 4 + 4));
      }
    }

    function showGrid() {
      gridDiv.innerHTML = "";
      for(let row of grid){
        for(let c of row){
          const cell = document.createElement("div");
          cell.className = "cell";
          cell.style.backgroundColor = c;
          gridDiv.appendChild(cell);
        }
      }
      gridDiv.classList.remove("hidden");
    }

    function startRound() {
      currentRound++;
      roundCounter.textContent = `Round ${currentRound} of ${totalRounds} ‚Äî ${totalRounds - currentRound} rounds remaining`;
      resultDiv.classList.add("hidden");
      correctDisplay.style.display = "none";
      inputArea.classList.add("hidden");
      answerInput.value = "";
      promptP.classList.remove("hidden");
      countdownP.classList.remove("hidden");
      nextBtn.classList.add("hidden");

      createGrid();
      showGrid();

      // Pick a random row or column to recall
      const isRow = Math.random() < 0.5;
      const index = Math.floor(Math.random() * 4);
      promptText = `${isRow ? "row" : "column"} ${index + 1}`;
      recallSet = isRow ? grid[index] : grid.map(r => r[index]);

      promptP.textContent = `Remember the colors in ${promptText}`;
      timeLeft = 60;
      timerSpan.textContent = timeLeft;

      // Start countdown timer
      timer = setInterval(() => {
        timeLeft--;
        timerSpan.textContent = timeLeft;
        if(timeLeft <= 0){
          clearInterval(timer);
          startRecall();
        }
      }, 1000);

      startBtn.classList.add("hidden");
    }

    function startRecall() {
      gridDiv.classList.add("hidden");
      countdownP.classList.add("hidden");
      promptP.textContent = `Enter the colors in ${promptText}`;
      inputArea.classList.remove("hidden");
      answerInput.focus();
    }

    function checkAnswer() {
      clearInterval(timer);
      const userInputRaw = answerInput.value.split(",").map(s => s.trim());
      const userInput = userInputRaw.map(normalizeColor);

      let correctCount = 0;
      for(let i=0; i<4; i++){
        if(normalizeColor(recallSet[i]) === userInput[i]){
          correctCount++;
        }
      }
      score += correctCount;

      resultDiv.textContent = `You got ${correctCount} out of 4 correct!`;
      resultDiv.classList.remove("hidden");
      inputArea.classList.add("hidden");

      // Show correct and user answers visually
      correctDisplay.style.display = "block";
      correctDisplay.innerHTML = `
        <strong>Correct sequence:</strong>
        <div class="display-colors">
          ${recallSet.map(c => `<div class="color-box" style="background:${c}"></div>`).join('')}
        </div>
        <strong>Your answer:</strong>
        <div class="display-colors">
          ${userInput.map(c => `<div class="color-box" style="background:${c}"></div>`).join('')}
        </div>
      `;

      if(currentRound < totalRounds){
        nextBtn.classList.remove("hidden");
      } else {
        finalSummary.style.display = "block";
        finalSummary.textContent = `Game over! Your total score: ${score} out of ${totalRounds*4}`;
        startBtn.textContent = "Play Again";
        startBtn.classList.remove("hidden");
      }
    }

    startBtn.addEventListener("click", () => {
      finalSummary.style.display = "none";
      currentRound = 0;
      score = 0;
      startRound();
    });

    submitBtn.addEventListener("click", () => {
      if(answerInput.value.trim() === ""){
        alert("Please enter your answer.");
        return;
      }
      checkAnswer();
    });

    nextBtn.addEventListener("click", () => {
      nextBtn.classList.add("hidden");
      resultDiv.classList.add("hidden");
      correctDisplay.style.display = "none";
      gridDiv.classList.remove("hidden");
      promptP.classList.remove("hidden");
      countdownP.classList.remove("hidden");
      inputArea.classList.add("hidden");
      answerInput.value = "";
      startRound();
    });

    // Allow Enter key to submit answer
    answerInput.addEventListener("keydown", e => {
      if(e.key === "Enter"){
        e.preventDefault();
        submitBtn.click();
      }
    });
  </script>
</body>
</html>

