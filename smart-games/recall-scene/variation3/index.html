<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no" />
  <title>Word Memory Game</title>
  <style>
    body {
      background-color: #fcefe3;
      font-family: 'Arial', sans-serif;
      color: black;
      text-align: center;
      margin: 0;
      padding: 0;
      overflow-x: hidden;
    }

    h1 {
      margin-top: 20px;
      font-size: 22px; /* Adjusted font size for mobile */
      padding: 0 10px;
    }

    .game-area {
      margin: 20px auto;
      max-width: 90%; /* Max width to ensure it's not too wide on small screens */
      position: relative;
    }

    /* Moved instructions and countdown to the top of the page */
    #topInfo {
      background-color: #a8dadc;
      padding: 15px;
      border-radius: 8px;
      margin-top: 10px;
      font-size: 16px;
      font-weight: bold;
    }

    .grid {
      display: grid;
      grid-template-columns: repeat(4, 1fr);
      gap: 10px;
      margin-top: 20px;
      max-width: 100%;
    }

    .cell {
      width: 100%;
      padding-top: 100%; /* Maintain square aspect ratio */
      border-radius: 10px;
      background-color: #ffffff;
      display: flex;
      justify-content: center;
      align-items: center;
      font-size: 14px; /* Smaller text for mobile */
      font-weight: bold;
      overflow: hidden;
      box-sizing: border-box;
    }

    .hidden {
      display: none;
    }

    .message {
      font-size: 16px; /* Adjusted font size for mobile */
      margin-top: 10px;
      line-height: 1.5;
    }

    button {
      background-color: #a8dadc;
      border: none;
      color: black;
      padding: 12px 20px;
      margin: 15px 10px;
      font-size: 16px;
      border-radius: 10px;
      cursor: pointer;
      width: 80%; /* Ensure buttons are wide enough on mobile */
      max-width: 300px; /* Limit max button size */
    }

    input[type="text"] {
      padding: 12px;
      font-size: 16px;
      margin: 10px;
      border-radius: 5px;
      border: 1px solid #ccc;
      width: 80%; /* Ensure input fits well on mobile */
      max-width: 300px;
    }

    #roundCounter {
      position: fixed;
      top: 10px;
      left: 10px;
      background: #a8dadc;
      padding: 8px 12px;
      border-radius: 8px;
      font-weight: bold;
      z-index: 1000;
      user-select: none;
      font-size: 14px;
    }

    #finalSummary {
      margin-top: 40px;
      font-size: 22px;
      background: #e1f0f7;
      border-radius: 10px;
      padding: 30px;
      display: none;
    }

    #correctDisplay {
      font-size: 16px;
      margin-top: 20px;
      background: #f0f0f0;
      border-radius: 10px;
      padding: 15px;
      display: none;
    }

    .display-words {
      margin-top: 10px;
      display: flex;
      justify-content: center;
      gap: 10px;
      flex-wrap: wrap; /* Allow wrapping on smaller screens */
    }

    .word-box {
      width: 60px;
      height: 60px;
      border-radius: 5px;
      background-color: #f0f0f0;
      display: flex;
      justify-content: center;
      align-items: center;
      font-size: 14px; /* Adjust font size to fit text on mobile */
    }

    #infoBanner {
      font-size: 18px;
      margin-top: 20px;
      padding: 20px;
      background-color: #ffcc00;
      border-radius: 10px;
      display: block;
      font-weight: bold;
    }
  </style>
</head>
<body>
  <div id="infoBanner">
    Welcome to the SMART Memory Game! Let's test your memory skills.
  </div>

  <div id="topInfo" class="message">
    <span id="roundCounter">Round 0 of 5 — 5 rounds remaining</span>
    <p id="prompt" class="hidden">Remember the words in the row/column...</p>
    <p id="countdown" class="hidden">⏳ Time left to remember: <span id="timer">60</span> seconds</p>
  </div>

  <div class="game-area">
    <div id="grid" class="grid"></div>
    <div id="input-area" class="hidden">
      <p>Type the words in order (like "dog, cat, bird"):</p>
      <input type="text" id="answer" placeholder="e.g. dog, cat, bird" autocomplete="off"/>
      <button id="submit">Submit</button>
    </div>

    <div id="result" class="hidden"></div>
    <div id="correctDisplay"></div>
    <button id="start">Start Game</button>
    <button id="next" class="hidden">Next Round</button>
    <div id="finalSummary"></div>
  </div>

  <script>
    const simpleWords = ["dog", "cat", "bird", "fish", "apple", "banana", "tree", "sun", "moon", "book", "ball", "star", "car", "hat", "shoe", "cloud"];
    const totalRounds = 5;

    const gridDiv = document.getElementById("grid");
    const promptP = document.getElementById("prompt");
    const countdownP = document.getElementById("countdown");
    const timerSpan = document.getElementById("timer");
    const inputArea = document.getElementById("input-area");
    const answerInput = document.getElementById("answer");
    const submitBtn = document.getElementById("submit");
    const resultDiv = document.getElementById("result");
    const correctDisplay = document.getElementById("correctDisplay");
    const startBtn = document.getElementById("start");
    const nextBtn = document.getElementById("next");
    const roundCounter = document.getElementById("roundCounter");
    const finalSummary = document.getElementById("finalSummary");
    const infoBanner = document.getElementById("infoBanner");
    const topInfo = document.getElementById("topInfo");

    let currentRound = 0;
    let grid = [];
    let recallSet = [];
    let promptText = "";
    let timer = null;
    let timeLeft = 60;
    let score = 0;

    // Function to normalize input (remove spaces and lowercase the words)
    function normalizeWord(input) {
      return input.toLowerCase().trim();
    }

    // Function to create a grid of words
    function createGrid() {
      const chosenWords = [];
      const totalCells = 16;
      const wordsCount = simpleWords.length;

      while (chosenWords.length < totalCells) {
        for (let word of simpleWords) {
          if (chosenWords.length < totalCells) {
            chosenWords.push(word);
          } else {
            break;
          }
        }
      }

      for (let i = chosenWords.length - 1; i > 0; i--) {
        const j = Math.floor(Math.random() * (i + 1));
        [chosenWords[i], chosenWords[j]] = [chosenWords[j], chosenWords[i]];
      }

      grid = [];
      for (let i = 0; i < 4; i++) {
        grid.push(chosenWords.slice(i * 4, i * 4 + 4));
      }
    }

    // Function to display the grid
    function showGrid() {
      gridDiv.innerHTML = "";
      for (let row of grid) {
        for (let c of row) {
          const cell = document.createElement("div");
          cell.className = "cell";
          cell.textContent = c;
          gridDiv.appendChild(cell);
        }
      }
      gridDiv.classList.remove("hidden");
    }

    // Function to start the game round
    function startRound() {
      currentRound++;
      if (currentRound === totalRounds) {
        roundCounter.textContent = "Last Round!";
      } else {
        roundCounter.textContent = `Round ${currentRound} of ${totalRounds}`;
      }

      createGrid();
      showGrid();

      const isRow = Math.random() > 0.5;
      const index = Math.floor(Math.random() * 4);
      promptText = `${isRow ? "row" : "column"} ${index + 1}`;
      recallSet = isRow ? grid[index] : grid.map(r => r[index]);

      promptP.textContent = `Remember the words in ${promptText}`;
      timeLeft = 60;
      timerSpan.textContent = timeLeft;

      timer = setInterval(() => {
        timeLeft--;
        timerSpan.textContent = timeLeft;
        if (timeLeft <= 0) {
          clearInterval(timer);
          startRecall();
        }
      }, 1000);

      infoBanner.style.display = "none"; // Hide the initial banner after game starts
      startBtn.classList.add("hidden");
    }

    // Function to start recalling the words
    function startRecall() {
      gridDiv.classList.add("hidden");
      countdownP.classList.add("hidden");
      promptP.textContent = `Enter the words in ${promptText}`;
      inputArea.classList.remove("hidden");
      answerInput.focus();
    }

    // Function to check the answer
    function checkAnswer() {
      clearInterval(timer);
      const userInputRaw = answerInput.value.split(",").map(s => s.trim());
      const userInput = userInputRaw.map(normalizeWord);

      let correctCount = 0;
      for (let i = 0; i < 4; i++) {
        if (normalizeWord(recallSet[i]) === userInput[i]) {
          correctCount++;
        }
      }
      score += correctCount;

      resultDiv.textContent = `You got ${correctCount} out of 4 correct!`;
      resultDiv.classList.remove("hidden");
      inputArea.classList.add("hidden");

      correctDisplay.style.display = "block";
      correctDisplay.innerHTML = `
        <strong>Correct sequence:</strong>
        <div class="display-words">
          ${recallSet.map(w => `<div class="word-box">${w}</div>`).join('')}
        </div>
        <strong>Your answer:</strong>
        <div class="display-words">
          ${userInput.map(w => `<div class="word-box">${w}</div>`).join('')}
        </div>
      `;

      if (currentRound < totalRounds) {
        nextBtn.classList.remove("hidden");
      } else {
        finalSummary.style.display = "block";
        finalSummary.innerHTML = `Game over! Your total score: ${score} out of ${totalRounds * 4}<br>Now, finish the survey and you will have earned an extra $2.50 for your SMART bank.`;

        // Tell Qualtrics the game is done, so it can show the Next button
        window.parent.postMessage("showNext", "*");

        startBtn.textContent = "Play Again";
        startBtn.classList.remove("hidden");
      }
    }

    startBtn.addEventListener("click", () => {
      finalSummary.style.display = "none";
      currentRound = 0;
      score = 0;
      startRound();
    });

    submitBtn.addEventListener("click", () => {
      if (answerInput.value.trim() === "") {
        alert("Please enter your answer.");
        return;
      }
      checkAnswer();
    });

    nextBtn.addEventListener("click", () => {
      nextBtn.classList.add("hidden");
      resultDiv.classList.add("hidden");
      correctDisplay.style.display = "none";
      gridDiv.classList.remove("hidden");
      promptP.classList.remove("hidden");
      countdownP.classList.remove("hidden");
      inputArea.classList.add("hidden");
      answerInput.value = "";
      startRound();
    });

    answerInput.addEventListener("keydown", e => {
      if (e.key === "Enter") {
        e.preventDefault();
        submitBtn.click();
      }
    });
  </script>
</body>
</html>
