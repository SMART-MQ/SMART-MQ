<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>SMART memory game</title>
  <style>
    body {
      background-color: #fcefe3;
      font-family: 'Arial', sans-serif;
      color: black;
      text-align: center;
      margin: 0;
      padding: 0;
    }

    #welcomeBanner {
      background-color: #a8dadc;
      color: black;
      font-weight: bold;
      padding: 20px;
      font-size: 1.5em;
      border-bottom: 4px solid #457b9d;
      user-select: none;
    }

    h1 {
      margin-top: 20px;
      font-size: 1.4em;
    }

    .game-area {
      margin: 20px auto;
      max-width: 600px;
      position: relative;
    }

    .scene {
      display: grid;
      grid-template-columns: repeat(4, 1fr);
      gap: 15px;
      margin-top: 20px;
      min-height: 300px;
    }

    .object {
      width: 90px;
      height: 90px;
      display: flex;
      justify-content: center;
      align-items: center;
      border-radius: 10px;
    }

    .object img {
      width: 80px;
      height: 80px;
    }

    .curtain {
      position: relative;
      width: 100%;
      height: 0;
      overflow: hidden;
      background-color: #d3cce3;
      font-size: 24px;
      padding: 0;
      transition: height 1s ease;
      border-radius: 10px;
      display: flex;
      justify-content: center;
      align-items: center;
      flex-direction: column;
    }

    .curtain.active {
      height: 200px;
      padding: 20px;
    }

    .message, #countdown {
      font-size: 0.9em;
      margin-top: 10px;
      color: #333;
    }

    button {
      background-color: #a8dadc;
      border: none;
      color: black;
      padding: 10px 20px;
      margin: 20px 10px;
      font-size: 0.9em;
      border-radius: 10px;
      cursor: pointer;
    }

    input[type="text"] {
      padding: 8px;
      font-size: 0.9em;
      margin: 10px;
      border-radius: 5px;
      border: 1px solid #ccc;
    }

    .hidden {
      display: none;
    }

    #roundCounter {
      position: fixed;
      bottom: 10px;
      left: 10px;
      background: #a8dadc;
      padding: 8px 12px;
      border-radius: 8px;
      font-weight: bold;
      z-index: 1000;
      user-select: none;
      font-size: 0.9em;
    }

    #finalSummary {
      margin-top: 40px;
      font-size: 22px;
      background: #e1f0f7;
      border-radius: 10px;
      padding: 30px;
      display: none;
    }

    .answer-display {
      margin-top: 15px;
      display: flex;
      justify-content: center;
      gap: 10px;
      user-select: none;
    }

    .answer-display img {
      width: 60px;
      height: 60px;
      border-radius: 10px;
      border: 2px solid transparent;
    }

    .answer-label {
      font-weight: bold;
      margin-bottom: 5px;
      font-size: 1em;
      color: #333;
    }

    /* Highlight unknown answers with red border */
    .answer-display img.unknown {
      border-color: red;
      opacity: 0.6;
    }
  </style>
</head>
<body>

  <div id="welcomeBanner">Welcome to the SMART Memory Game!</div>

  <h1>SMART memory game</h1>
  <p>Look carefully and remember the pictures! You'll be asked to remember a specific row or column.</p>

  <div id="roundCounter" class="message">Round 0 of 5 ‚Äî 5 rounds remaining</div>

  <div class="game-area">
    <div id="scene" class="scene"></div>
    <p id="viewingMessage" class="message hidden">‚è≥ Time left to view: <span id="viewingCountdown">60</span> seconds</p>

    <div id="curtain" class="curtain">
      <p><strong>üé≠ The curtain is down.</strong></p>
      <p class="message" id="recallInstruction">Now think carefully... what did you see in the selected row/column?</p>
    </div>

    <div id="input-area" class="hidden">
      <p>Type the names of the images you remember (like "apple", "car", "cat"):</p>
      <input type="text" id="answer" placeholder="e.g. apple, book, ball"/>
      <p id="countdown" class="message">‚è≥ Time left to answer: <span id="answerCountdown">60</span> seconds</p>
      <button id="submitAnswerBtn">Submit Answer</button>
    </div>

    <div id="result" class="hidden"></div>
    <button id="startBtn">Start Game</button>
    <button id="nextBtn" class="hidden">Next Round</button>

    <div id="finalSummary"></div>
  </div>

  <script>
    const objectLibrary = {
      apple: "https://img.icons8.com/color/96/apple.png",
      book: "https://img.icons8.com/color/96/book.png",
      ball: "https://img.icons8.com/emoji/96/soccer-ball-emoji.png",
      cat: "https://img.icons8.com/color/96/cat.png",
      car: "https://img.icons8.com/color/96/car.png",
      hat: "https://img.icons8.com/emoji/96/top-hat-emoji.png",
      star: "https://img.icons8.com/color/96/star.png",
      fish: "https://img.icons8.com/color/96/fish.png",
      pen: "https://img.icons8.com/emoji/96/pen-emoji.png",
      leaf: "https://img.icons8.com/color/96/leaf.png",
      cake: "https://img.icons8.com/color/96/birthday-cake.png",
      dog: "https://img.icons8.com/color/96/dog.png",
      flower: "https://img.icons8.com/color/96/flower.png",
      globe: "https://img.icons8.com/color/96/globe.png",
      kite: "https://img.icons8.com/color/96/kite.png",
      moon: "https://img.icons8.com/emoji/96/crescent-moon-emoji.png"
    };

    // Acceptable answer variants (lowercase)
    const acceptableAnswers = {
      apple: ["apple"],
      book: ["book"],
      ball: ["ball", "soccer ball", "football"],
      cat: ["cat"],
      car: ["car"],
      hat: ["hat", "top hat"],
      star: ["star"],
      fish: ["fish"],
      pen: ["pen", "pencil"],
      leaf: ["leaf"],
      cake: ["cake", "birthday cake"],
      dog: ["dog"],
      flower: ["flower"],
      globe: ["globe", "world", "earth"],
      kite: ["kite"],
      moon: ["moon", "crescent moon"]
    };

    const allObjects = Object.keys(objectLibrary);
    let gridObjects = [];
    let currentPrompt = "";
    let recallObjects = [];
    let round = 0;
    let score = 0;
    let roundScores = [];
    const totalRounds = 5;
    let viewTimer, answerTimer;

    const roundCounterEl = document.getElementById('roundCounter');
    const finalSummaryDiv = document.getElementById('finalSummary');
    const welcomeBanner = document.getElementById('welcomeBanner');

    const startBtn = document.getElementById('startBtn');
    const nextBtn = document.getElementById('nextBtn');
    const submitAnswerBtn = document.getElementById('submitAnswerBtn');

    startBtn.addEventListener('click', startGame);
    nextBtn.addEventListener('click', nextRound);
    submitAnswerBtn.addEventListener('click', checkAnswer);

    function getRandomGrid() {
      const shuffled = [...allObjects].sort(() => 0.5 - Math.random()).slice(0, 16);
      const grid = [];
      while (shuffled.length) grid.push(shuffled.splice(0, 4));
      return grid;
    }

    function updateRoundCounter() {
      const roundsLeft = totalRounds - round;
      if (round === totalRounds - 1) {
        roundCounterEl.textContent = "Last Round!";
      } else {
        roundCounterEl.textContent = `Round ${round + 1} of ${totalRounds} ‚Äî ${roundsLeft} rounds remaining`;
      }
    }

    function startGame() {
      // Hide welcome banner
      welcomeBanner.style.display = 'none';

      score = 0;
      round = 0;
      roundScores = [];
      finalSummaryDiv.style.display = 'none';
      startBtn.classList.add('hidden');
      nextBtn.classList.add('hidden');
      roundCounterEl.style.display = 'block';
      updateRoundCounter();
      nextRound();
    }

    function nextRound() {
      resetTimers();
      document.getElementById('scene').innerHTML = '';
      document.getElementById('result').classList.add('hidden');
      document.getElementById('curtain').classList.remove('active');
      document.getElementById('input-area').classList.add('hidden');
      document.getElementById('answer').value = '';
      document.getElementById('viewingMessage').classList.remove('hidden');
      nextBtn.classList.add('hidden');

      gridObjects = getRandomGrid();
      const sceneDiv = document.getElementById('scene');
      sceneDiv.classList.remove('hidden');

      for (const row of gridObjects) {
        for (const item of row) {
          const div = document.createElement('div');
          div.className = 'object';
          const img = document.createElement('img');
          img.src = objectLibrary[item];
          img.alt = item;
          div.appendChild(img);
          sceneDiv.appendChild(div);
        }
      }

      const rowOrCol = Math.random() < 0.5 ? "row" : "column";
      const index = Math.floor(Math.random() * 4);
      currentPrompt = `${rowOrCol} ${index + 1}`;
      document.getElementById('viewingMessage').innerHTML = `üîç Memorize the pictures! Focus on <strong>${currentPrompt}</strong> - <span id="viewingCountdown">60</span> seconds`;

      recallObjects = rowOrCol === "row" ? gridObjects[index] : gridObjects.map(r => r[index]);

      let viewTime = 60;
      viewTimer = setInterval(() => {
        viewTime--;
        document.getElementById('viewingCountdown').textContent = viewTime;
        if (viewTime <= 0) {
          clearInterval(viewTimer);
          hideSceneShowCurtain();
        }
      }, 1000);

      updateRoundCounter();
    }

    function resetTimers() {
      clearInterval(viewTimer);
      clearInterval(answerTimer);
    }

    function hideSceneShowCurtain() {
      document.getElementById('scene').classList.add('hidden');
      document.getElementById('viewingMessage').classList.add('hidden');
      const curtain = document.getElementById('curtain');
      curtain.classList.add('active');

      document.getElementById('input-area').classList.remove('hidden');

      let answerTime = 60;
      document.getElementById('answerCountdown').textContent = answerTime;

      answerTimer = setInterval(() => {
        answerTime--;
        document.getElementById('answerCountdown').textContent = answerTime;
        if (answerTime <= 0) {
          clearInterval(answerTimer);
          checkAnswer();
        }
      }, 1000);
    }

    function findObjectByAnswer(ans) {
      ans = ans.toLowerCase();
      for (const [key, variants] of Object.entries(acceptableAnswers)) {
        if (variants.includes(ans)) return key;
      }
      return null;
    }

    function checkAnswer() {
      clearInterval(answerTimer);

      const input = document.getElementById('answer').value.toLowerCase();
      const answers = input.split(',').map(s => s.trim()).filter(s => s.length > 0);

      // Track which recall objects have been matched already
      const matchedObjects = new Set();

      answers.forEach(answer => {
        for (const obj of recallObjects) {
          const possibleAnswers = acceptableAnswers[obj];
          if (possibleAnswers.includes(answer) && !matchedObjects.has(obj)) {
            matchedObjects.add(obj);
            break;
          }
        }
      });

      const roundScore = matchedObjects.size;

      score += roundScore;
      roundScores.push(roundScore);

      const result = document.getElementById('result');

      // Show correct answer images in order
      const correctAnswerImages = recallObjects.map(obj => {
        const src = objectLibrary[obj];
        return `<img src="${src}" alt="${obj}" title="${obj}">`;
      }).join("");

      // Show player's answer images in typed order, with red border for unknown or unmatched
      const playerAnswerImages = answers.map(ans => {
        const objKey = findObjectByAnswer(ans);
        if (objKey) {
          const src = objectLibrary[objKey];
          // Highlight if that object wasn't part of the correct recall set (optional)
          const isInRecall = recallObjects.includes(objKey);
          return `<img src="${src}" alt="${ans}" title="${ans}" ${isInRecall ? '' : 'class="unknown"'}>`;
        } else {
          // Unknown answer - use a placeholder or a red-bordered question mark icon
          return `<img src="https://img.icons8.com/ios/50/ff0000/question-mark.png" alt="unknown" title="Unknown answer" class="unknown">`;
        }
      }).join("");

      result.innerHTML = `
        <p>You scored <strong>${roundScore}</strong> point${roundScore !== 1 ? "s" : ""} this round.</p>
        <div>
          <div class="answer-label">Correct answer:</div>
          <div class="answer-display">${correctAnswerImages}</div>
        </div>
        <div style="margin-top: 12px;">
          <div class="answer-label">Your answer:</div>
          <div class="answer-display">${playerAnswerImages}</div>
        </div>
      `;
      result.classList.remove('hidden');

      document.getElementById('input-area').classList.add('hidden');
      document.getElementById('curtain').classList.remove('active');

      round++;
      updateRoundCounter();

      if (round >= totalRounds) {
        showFinalSummary();
      } else {
        nextBtn.classList.remove('hidden');
      }
    }

    function showFinalSummary() {
      roundCounterEl.style.display = 'none';
      document.getElementById('scene').classList.add('hidden');
      document.getElementById('curtain').classList.remove('active');
      document.getElementById('input-area').classList.add('hidden');
      document.getElementById('result').classList.add('hidden');
      nextBtn.classList.add('hidden');

      finalSummaryDiv.style.display = 'block';

      const totalScore = score;
      const averageScore = (score / totalRounds).toFixed(2);

      finalSummaryDiv.innerHTML = `
        <h2>Game Over!</h2>
        <p>Your total score: <strong>${totalScore}</strong></p>
        <p>Your average score per round: <strong>${averageScore}</strong></p>
        <p>Thanks for playing the SMART Memory Game! üéâ</p>
        <button id="playAgainBtn">Play Again</button>
      `;

      document.getElementById('playAgainBtn').addEventListener('click', () => {
        finalSummaryDiv.style.display = 'none';
        startBtn.classList.remove('hidden');
      });
    }
  </script>
</body>
</html>
